<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitFusion360</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="icon" href="./img/fit-fusion-logo.png" type="image/png">
    
    <style>
        :root {
            /* LANDING PAGE THEME */
            --bg-dark: #0f172a;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #06b6d4;      
            --accent-purple: #6366f1; 
            
            /* APP THEME (Light - Matched to your code) */
            --app-bg: #F9FAFB;
            --app-card: #FFFFFF;
            --app-text: #111827;
            --app-text-sub: #6B7280;
            --app-primary: #2563EB;
            --app-success: #10B981;
            --app-warning: #F59E0B;
            --app-purple: #8B5CF6;
            
            /* Updated Dimensions for 20:9 Aspect Ratio */
            /* Scaled 0.42x results in visual size ~361px x 722px */
            --phone-width: 860px;
            --phone-height: 1720px; 
            
            /* Modern Android Geometry */
            --phone-radius: 55px;  /* Tighter, modern corners */
            --screen-radius: 42px; /* Matches chassis curvature */
            --border-thick: 18px;  /* Uniform bezel thickness */
            --cam-size: 26px;      /* Punch-hole diameter */
            
            /* Android Hardware Colors */
            --frame-color: #1e293b; /* Matte Obsidian/Charcoal */
            --btn-color: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- BACKGROUND --- */
        .bg-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s infinite alternate; }
        .blob-1 { width: 500px; height: 500px; background: var(--accent-purple); top: -100px; left: -100px; }
        .blob-2 { width: 600px; height: 600px; background: var(--accent); bottom: -100px; right: -100px; animation-delay: -5s; }
        .blob-3 { width: 300px; height: 300px; background: #ec4899; top: 40%; left: 30%; opacity: 0.2; animation-duration: 30s; }
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(50px, 50px); } }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3, h4 { font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 1px; }
        h1 {
            font-size: clamp(3rem, 5vw, 4.5rem); line-height: 1.1; margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #cbd5e1 50%, var(--accent) 100%);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 30px rgba(6,182,212,0.3));
        }
        h2 { font-size: clamp(2rem, 4vw, 3rem); margin-bottom: 1rem; color: var(--accent); text-shadow: 0 0 20px rgba(6,182,212,0.2); }
        p { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1.5rem; }

        /* --- LAYOUT --- */
        .container { display: flex; position: relative; max-width: 1400px; margin: 0 auto; flex: 1; }
        .content-column { width: 50%; padding: 0 6%; z-index: 10; position: relative; }

        section {
            min-height: auto; padding: 80px 0;
            display: flex; flex-direction: column; justify-content: center;
            opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);
        }
        section.visible { opacity: 1; transform: translateY(0); }

        .logo-img { width: 140px; margin-bottom: 0; filter: drop-shadow(0 0 25px rgba(6,182,212,0.6)); }
        .logo-container { display: flex; align-items: center; gap: 20px; margin-bottom: 2rem; }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1); padding: 25px; border-radius: 20px;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); margin-bottom: 20px;
            transition: transform 0.3s, border-color 0.3s;
        }
        .glass-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }

        .value-matrix {
            display: flex; gap: 10px; margin-bottom: 30px; font-size: 0.9rem; font-family: 'Inter', monospace;
            color: var(--accent); background: rgba(6, 182, 212, 0.1);
            padding: 15px; border-radius: 8px; border-left: 3px solid var(--accent);
        }
        .vm-item { display: flex; flex-direction: column; }
        .vm-label { color: var(--text-secondary); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }

        .comparison-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.95rem; }
        .comparison-table th { text-align: left; padding: 15px; color: var(--accent); border-bottom: 2px solid rgba(255,255,255,0.1); }
        .comparison-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-secondary); }
        .comparison-table td:first-child { color: #fff; font-weight: 600; }
        .comparison-table .check { color: var(--success); }
        .comparison-table .cross { color: #ef4444; opacity: 0.5; }

        .data-flow {
            display: flex; align-items: center; gap: 15px; margin: 20px 0;
            background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px;
        }
        .df-step { text-align: center; flex: 1; }
        .df-icon { font-size: 1.5rem; margin-bottom: 10px; color: var(--text-primary); }
        .df-arrow { color: var(--text-secondary); font-size: 0.8rem; }
        .df-label { font-size: 0.8rem; color: var(--text-secondary); }

        .feature-list { list-style: none; }
        .feature-item { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; }
        .feature-icon { 
            background: rgba(255,255,255,0.1); color: var(--accent); width: 40px; height: 40px; 
            border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .feature-text strong { color: #fff; display: block; font-size: 1rem; }
        .feature-text span { font-size: 0.9rem; color: var(--text-secondary); }

        .trust-bar {
            display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 40px;
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;
        }
        .trust-item { font-size: 0.9rem; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; }
        .trust-icon { color: var(--success); }

        .btn-group { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; align-items: center; }
        .btn {
            padding: 16px 32px; border-radius: 12px; text-decoration: none; font-weight: 700;
            font-size: 1rem; transition: all 0.3s; display: flex; align-items: center; gap: 12px;
            cursor: pointer; border: none; font-family: 'Inter', sans-serif; justify-content: center;
        }
        .btn-primary { background: var(--accent); color: #0f172a; box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); flex: 2; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 0 30px rgba(6, 182, 212, 0.5); }
        .btn-secondary { background: transparent; border: 1px solid var(--text-secondary); color: var(--text-secondary); flex: 1; font-size: 0.9rem; padding: 16px 20px; }
        .btn-secondary:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.05); }

        .tag {
            display: inline-block; padding: 4px 12px; border-radius: 50px; 
            font-size: 0.75rem; font-weight: bold; text-transform: uppercase; margin-bottom: 10px;
        }
        .tag-blue { background: rgba(6, 182, 212, 0.2); color: var(--accent); border: 1px solid rgba(6, 182, 212, 0.4); }
        .tag-purple { background: rgba(99, 102, 241, 0.2); color: var(--accent-purple); border: 1px solid rgba(99, 102, 241, 0.4); }
        .tag-guest { background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid var(--success); margin-top: 15px; font-size: 0.8rem; cursor: default; }

        /* --- FOOTER --- */
        footer {
            background: rgba(15, 23, 42, 0.95); border-top: 1px solid rgba(255,255,255,0.1);
            padding: 60px 0 30px; margin-top: auto; z-index: 20; position: relative;
        }
        .footer-content {
            max-width: 1400px; margin: 0 auto; padding: 0 6%;
            display: flex; flex-direction: column; gap: 40px;
        }
        .footer-links {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px;
        }
        .footer-section h3 { 
            color: var(--accent); font-size: 1.1rem; font-weight: 700; margin-bottom: 20px; 
            font-family: 'Inter', sans-serif; text-transform: uppercase; letter-spacing: 1px;
        }
        .footer-section ul { list-style: none; }
        .footer-section li { margin-bottom: 10px; }
        .footer-section a, .footer-section button { 
            background: none; border: none; color: var(--text-secondary); cursor: pointer; text-decoration: none;
            font-size: 0.9rem; transition: color 0.3s; font-family: 'Inter', sans-serif;
        }
        .footer-section a:hover, .footer-section button:hover { color: var(--accent); text-decoration: underline; }
        .powered-by { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .powered-item { 
            display: flex; align-items: center; gap: 15px; padding: 15px; 
            background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
        }
        .powered-icon { font-size: 1.5rem; color: var(--accent); }
        .powered-text strong { color: #fff; display: block; font-size: 0.9rem; }
        .powered-text span { font-size: 0.8rem; color: var(--text-secondary); }
        .copyright { 
            text-align: center; margin-top: 40px; padding-top: 20px; 
            border-top: 1px solid rgba(255,255,255,0.1); color: var(--text-secondary); font-size: 0.9rem;
        }

        /* --- VISUAL COLUMN & PHONE (Modern Android / Pixel Class) --- */
        :root {
            /* 1. VISUAL DIMENSIONS (Wider, Shorter Stance) */
            /* Ratio adjusted to ~16:9 for better optical weight */
            --phone-width: 1200px;   /* Increased from 860px */
            --phone-height: 1500px; /* Adjusted for proportion */
            
            /* 2. GEOMETRY (Pixel 9 / S24 Style) */
            --phone-radius: 58px;   /* Boxier corners */
            --screen-radius: 44px;  /* Matching inner radius */
            --border-thick: 16px;  /* Thinner, premium bezels */
            --cam-size: 24px;       /* Smaller, tighter punch hole */
            
            /* 3. HARDWARE FINISH */
            --frame-color: #0f172a; /* Deep matte black/blue */
        }

        .visual-column {
            width: 50%; height: 100vh; position: sticky; top: 0;
            display: flex; align-items: center; justify-content: center;
            perspective: 2500px; 
        }

        .phone-wrapper {
            width: var(--phone-width); height: var(--phone-height);
            position: relative; transform-style: preserve-3d; will-change: transform;
            /* Scale set to 0.5 for better clarity */
            transform: scale(0.5); 
            transition: transform 0.1s ease-out;
        }

        .phone-frame {
            width: 100%; height: 100%; 
            border-radius: var(--phone-radius); 
            background: #000; /* Screen bezel color */
            
            /* Bezel Construction */
            box-shadow: 
                0 0 0 4px var(--frame-color), /* Physical Frame */
                inset 0 0 0 2px rgba(255,255,255,0.1), /* Inner Bezel Highlight */
                50px 60px 120px rgba(0,0,0,0.6); /* Depth Shadow */
            
            position: relative; 
            border: var(--border-thick) solid #000;
        }
        
        /* ANDROID PUNCH-HOLE CAMERA */
        .punch-hole {
            position: absolute; top: 25px; left: 50%; transform: translateX(-50%);
            width: var(--cam-size); height: var(--cam-size);
            background: #000; border-radius: 50%; z-index: 50;
            box-shadow: inset 0 0 6px rgba(255,255,255,0.2);
        }

        /* PIXEL BUTTON LAYOUT (Right Side) */
        .hw-btn { 
            position: absolute; background: var(--frame-color); 
            right: -10px; /* Protruding right */
            width: 6px; border-radius: 0 4px 4px 0;
            box-shadow: -2px 0 4px rgba(0,0,0,0.3);
        }
        
        /* Power Button (Above Volume on Pixel) */
        .power { top: 220px; height: 70px; background: #475569; }
        
        /* Volume Rocker */
        .vol-rocker { top: 310px; height: 110px; }

        /* --- APP SCREEN CONTAINER --- */
        .screen-container {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--app-bg); border-radius: var(--screen-radius); 
            overflow: hidden; backface-visibility: hidden; transform: translateZ(0);
        }
        
        /* Updated App View base */
        .app-view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; font-family: 'Inter', sans-serif;
            background: var(--app-bg);
            transition: opacity 0.5s ease-in-out;
            opacity: 0; pointer-events: none; z-index: 0;
        }
        .app-view.active { opacity: 1; pointer-events: all; z-index: 10; }

        /* ADJUSTED HEADERS FOR PUNCH HOLE (Less height than Notch) */
        .app-header { padding: 50px 40px 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .workout-header { padding: 50px 40px 20px; display: flex; align-items: center; gap: 20px; background: #fff; }
        .chat-header { padding: 50px 40px 20px; display: flex; gap: 20px; align-items: center; border-bottom: 1px solid #F3F4F6; background: #fff; }


        /* --- SCREEN 1: FOOD TRACKER (Matches your code) --- */
        .app-header { padding: 60px 40px 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .app-brand { display: flex; align-items: center; gap: 20px; }
        .app-logo-small { width: 70px; height: 70px; border-radius: 50%; background: #333; image-rendering: crisp-edges; }
        .app-name { font-size: 1.1rem; font-weight: 700; color: var(--app-text); }
        .guest-badge { background: #F3F4F6; padding: 8px 20px; border-radius: 40px; display: flex; align-items: center; gap: 10px; font-size: 0.8rem; color: #4B5563; font-weight: 600; }
        .guest-dot { width: 16px; height: 16px; background: var(--app-warning); border-radius: 50%; }
        
        .app-content { flex: 1; overflow-y: auto; padding: 30px; background: #F9FAFB; }
        .app-content::-webkit-scrollbar { display: none; }

        .date-nav { display: flex; justify-content: space-between; align-items: center; margin: 20px 0 40px; }
        .nav-circle { width: 80px; height: 80px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; border: 2px solid #E5E7EB; color: var(--app-text); font-size: 1.2rem; }
        .date-center { text-align: center; }
        .date-title { font-weight: 700; color: var(--app-text); font-size: 1.1rem; }
        .date-sub { color: var(--app-text-sub); font-size: 0.9rem; }

        .toggle-row { display: flex; gap: 30px; margin-bottom: 50px; }
        .toggle-btn { flex: 1; padding: 24px; border-radius: 24px; font-weight: 600; font-size: 0.9rem; text-align: center; display: flex; justify-content: center; align-items: center; gap: 15px; }
        .toggle-outline { background: #fff; color: var(--app-primary); border: 2px solid #E5E7EB; }
        .toggle-filled { background: var(--app-primary); color: #fff; border: 2px solid var(--app-primary); }

        .progress-card { background: #fff; border-radius: 48px; padding: 40px; margin-bottom: 50px; box-shadow: 0 8px 40px rgba(0,0,0,0.05); }
        .card-title { font-size: 1.2rem; font-weight: 700; color: var(--app-text); margin-bottom: 40px; }
        .ring-container { position: relative; width: 320px; height: 320px; margin: 0 auto 60px; }
        .ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-bg { stroke: #F3F4F6; stroke-width: 20; fill: none; }
        .ring-fill { stroke: var(--app-primary); stroke-width: 20; stroke-dasharray: 880; stroke-dashoffset: 880; stroke-linecap: round; fill: none; animation: fillRing 1.5s forwards ease-out; }
        @keyframes fillRing { to { stroke-dashoffset: 600; } }
        .ring-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .ring-num { font-size: 2.2rem; font-weight: 800; color: var(--app-text); line-height: 1; }
        .ring-sub { font-size: 0.8rem; color: var(--app-text-sub); margin-top: 10px; }

        .macro-row { display: flex; gap: 20px; margin-bottom: 50px; }
        .macro-item { flex: 1; background: #F9FAFB; padding: 30px 20px; border-radius: 32px; text-align: center; }
        .macro-bar { height: 8px; width: 80px; margin: 0 auto 20px; border-radius: 4px; }
        .mb-green { background: #D1FAE5; } .mb-green div { width: 0%; height: 100%; background: var(--app-success); border-radius: 4px; }
        .mb-yellow { background: #FEF3C7; } .mb-yellow div { width: 0%; height: 100%; background: var(--app-warning); border-radius: 4px; }
        .mb-purple { background: #EDE9FE; } .mb-purple div { width: 0%; height: 100%; background: var(--app-purple); border-radius: 4px; }
        .macro-val { font-weight: 700; color: var(--app-text); font-size: 1rem; display: block; margin-bottom: 5px; }
        .macro-lbl { font-size: 0.8rem; color: var(--app-text-sub); }
        .macro-goal { font-size: 0.7rem; color: #9CA3AF; margin-top: 5px; }

        .card-footer { display: flex; justify-content: space-between; padding-top: 30px; border-top: 2px solid #F3F4F6; }
        .footer-badge { display: flex; align-items: center; gap: 12px; font-size: 0.8rem; font-weight: 600; }
        .fb-blue { color: var(--app-primary); }
        .fb-purple { color: var(--app-purple); }

        .log-header { margin-bottom: 40px; }
        .log-title { font-size: 1.1rem; font-weight: 700; color: var(--app-text); margin-bottom: 10px; }
        .log-sub { color: var(--app-text-sub); font-size: 0.9rem; }

        .bottom-nav { background: #fff; border-top: 2px solid #F3F4F6; padding: 30px 40px 50px; display: flex; justify-content: space-between; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 8px; color: #9CA3AF; }
        .nav-item.active { color: var(--app-primary); }
        .nav-item i { font-size: 1.4rem; }
        .nav-item span { font-size: 0.7rem; font-weight: 600; }

        /* --- SCREEN 2: WORKOUT (Recreated from screenshot) --- */
        .workout-header { padding: 60px 40px 20px; display: flex; align-items: center; gap: 20px; background: #fff; }
        .back-btn { width: 60px; height: 60px; border-radius: 50%; background: #F3F4F6; display: flex; align-items: center; justify-content: center; color: #374151; font-size: 1.2rem; }
        .workout-nav-title { font-size: 1.3rem; font-weight: 800; color: #000; }
        .workout-sub { color: var(--app-text-sub); font-size: 0.9rem; }
        
        .workout-card { background: #fff; border-radius: 0 0 32px 32px; padding: 30px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .badge-pill { background: #EDE9FE; color: #7C3AED; padding: 6px 16px; border-radius: 16px; font-size: 0.8rem; font-weight: 700; float: right; }
        .ex-title { font-size: 1.6rem; font-weight: 800; color: #000; margin-bottom: 20px; line-height: 1.2; clear: right; }
        
        .video-placeholder { 
            height: 350px; background: #374151; border-radius: 24px; margin-bottom: 30px; position: relative; overflow: hidden;
            background-image: url('./img/0.jpg');
            background-size: cover;
            background-position: center;
            display: flex; align-items: center; justify-content: center;
            image-rendering: crisp-edges;
        }
        .vid-overlay { position: absolute; bottom: 20px; left: 20px; background: var(--app-success); padding: 10px 20px; border-radius: 30px; color: #fff; font-weight: 600; font-size: 0.9rem; display: flex; gap: 8px; align-items: center; }
        
        .tag-row { display: flex; gap: 15px; margin-bottom: 30px; }
        .tag-chip { background: #F9FAFB; padding: 15px; border-radius: 16px; font-weight: 600; font-size: 0.9rem; color: #374151; flex: 1; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        .set-card { background: #fff; border-radius: 32px; padding: 40px; text-align: center; border: 1px solid #F3F4F6; margin: 0 30px; }
        .timer-circle { 
            width: 200px; height: 200px; border-radius: 50%; border: 12px solid #E5E7EB; border-top-color: var(--app-success); 
            margin: 30px auto; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .timer-val { font-size: 3.5rem; font-weight: 800; color: var(--app-success); }
        .timer-lbl { font-size: 1rem; color: var(--app-text-sub); }
        
        .workout-actions { padding: 30px; display: flex; gap: 20px; }
        .btn-ex { flex: 1; padding: 20px; border-radius: 20px; font-weight: 700; text-align: center; font-size: 1rem; }
        .btn-ex-light { background: #F3F4F6; color: #374151; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-ex-dark { background: #D1D5DB; color: #fff; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* --- SCREEN 3: CHATBOT (Recreated from screenshot) --- */
        .chat-header { padding: 60px 40px 20px; display: flex; gap: 20px; align-items: center; border-bottom: 1px solid #F3F4F6; background: #fff; }
        .chat-title { font-weight: 700; font-size: 1.2rem; color: #000; }
        .chat-body { padding: 30px; flex: 1; overflow-y: auto; background: #fff; }
        
        .bot-msg { display: flex; gap: 15px; margin-bottom: 30px; }
        .bot-avatar { width: 40px; height: 40px; background: #EFF6FF; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--app-primary); flex-shrink: 0; }
        .msg-bubble { background: #fff; padding: 0; max-width: 90%; }
        .msg-text { font-size: 1rem; color: #1F2937; line-height: 1.5; margin-bottom: 20px; }
        .msg-list { padding-left: 0; margin-bottom: 20px; list-style: none; }
        .msg-list li { font-size: 1rem; color: #1F2937; margin-bottom: 10px; display: flex; gap: 10px; }
        
        .msg-disclaimer { 
            font-size: 0.9rem; color: #4B5563; font-style: italic; 
            background: #FEF3C7; padding: 20px; border-radius: 16px; border: 1px solid #FDE68A; 
            display: flex; gap: 10px; align-items: flex-start;
        }
        
        .chat-footer { padding: 20px; background: #fff; border-top: 1px solid #F3F4F6; }
        .suggestion-row { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .suggestion-chip { 
            padding: 10px 20px; border-radius: 30px; border: 1px solid #BFDBFE; color: var(--app-primary); 
            font-size: 0.9rem; font-weight: 600; white-space: nowrap; background: #EFF6FF; display: flex; gap: 8px;
        }
        .input-box { 
            background: #F9FAFB; padding: 15px 25px; border-radius: 40px; border: 1px solid #E5E7EB;
            color: #9CA3AF; font-size: 1rem; display: flex; justify-content: space-between; align-items: center;
        }
        .send-btn { width: 40px; height: 40px; background: #D1D5DB; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; }

        /* --- ANNOTATIONS --- */
        .annotation {
            position: absolute; background: rgba(15, 23, 42, 0.9); border: 1px solid var(--accent);
            color: #fff; padding: 12px 20px; border-radius: 8px; font-size: 1.2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); pointer-events: none;
            display: flex; align-items: center; gap: 10px;
            transform: translateZ(50px);
        }
        .pulse { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 10px var(--accent); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .anno-1 { top: 300px; left: -140px; }
        .anno-2 { top: 800px; right: -180px; }
        .anno-3 { bottom: 400px; left: -140px; }

        /* --- PARALLAX LAYERS --- */
        .parallax-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 0; }
        .floating-element { position: absolute; z-index: -1; }
        .layer-back { opacity: 0.05; filter: blur(4px); z-index: -2; }
        .layer-mid { opacity: 0.1; filter: blur(1px); z-index: -1; }
        .layer-front { opacity: 0.15; filter: blur(0px); z-index: 0; }

        /* --- MODALS --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; backdrop-filter: blur(5px); }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { background: #1e293b; width: 90%; max-width: 500px; max-height: 85vh; padding: 40px; border-radius: 24px; text-align: center; border: 1px solid #334155; transform: translateY(20px); transition: transform 0.3s ease; overflow-y: auto; position: relative; }
        .modal-content.legal { max-width: 800px; text-align: left; }
        .modal-content.legal h2 { margin-top: 20px; font-size: 1.5rem; color: var(--accent); }
        .modal-content.legal p, .modal-content.legal ul { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 15px; }
        .modal-content.legal ul { margin-left: 20px; }
        .faq-section h3 { color: var(--accent); font-size: 1.1rem; margin-top: 20px; margin-bottom: 10px; }
        .faq-section p { margin-bottom: 15px; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .close-modal { position: absolute; top: 20px; right: 20px; background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer; z-index: 10; }
        .qr-placeholder { background: #fff; padding: 10px; border-radius: 12px; margin: 20px auto; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; }
        .qr-img { width: 100%; height: 100%; object-fit: contain; }
        #contactForm { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        #contactForm input, #contactForm textarea { 
            padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
            background: rgba(30,41,59,0.5); color: var(--text-primary); font-size: 0.9rem;
        }
        #contactForm textarea { height: 120px; resize: vertical; }
        #contactForm button { align-self: flex-start; padding: 12px 24px; }
        #contactStatus { margin-top: 15px; font-size: 0.9rem; }

        /* --- RESPONSIVE --- */
        @media (max-width: 968px) {
            .container { display: block; }
            .content-column { width: 100%; padding: 60px 20px 40px; }
            .visual-column { display: none; }
            .annotation, .parallax-wrapper, .bg-blobs { display: none !important; }
            .footer-content { flex-direction: column; text-align: center; }
            .footer-links { display: flex; flex-direction: column; gap: 40px; }
            .powered-by { display: flex; flex-direction: column; gap: 15px; }
            .footer-links button, .footer-links a { margin: 0 10px; display: inline-block; }
            .btn { flex: 1 1 100%; margin-bottom: 10px; }
            .logo-container { flex-direction: column; gap: 10px; text-align: center; }
            .logo-img { width: 100px; margin-bottom: 0; }
        }

        @media (max-width: 1200px) and (min-width: 969px) {
            .phone-wrapper { transform: scale(0.4); }
        }

        /* --- Hover preview (Wikipedia-style) --- */
        .hover-card {
            position: absolute;
            display: none; /* Hidden by default */
            width: 320px;
            max-width: calc(100vw - 32px);
            background: rgba(30,41,59,0.96); /* Matches glass-card */
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 9999;
            pointer-events: none; /* Prevents flicker when cursor overlaps */
            font-family: 'Inter', sans-serif;
            transition: transform 0.12s ease, opacity 0.12s ease;
        }
        .hover-card[aria-hidden="false"] { display: block; opacity: 1; }
        .hover-card h4 {
            color: var(--accent);
            font-size: 0.9rem;
            margin: 0 0 8px 0;
            font-weight: 700;
            text-transform: none;
        }
        .hover-card p {
            font-size: 0.82rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin: 0;
        }

        /* --- Link color system (fixes clashing blue links) --- */
        :root {
            --link-color: var(--accent);
            --link-hover: #ffffff;
            --link-muted: var(--text-secondary);
        }

        /* Apply to in-content links only (explicitly exclude component buttons) */
        .content-column a:not(.btn),
        .feature-text a:not(.btn),
        .comparison-table a:not(.btn),
        .app-content a:not(.btn) {
            color: var(--link-color);
            text-decoration: underline dotted rgba(6,182,212,0.14);
            text-underline-offset: 3px;
            transition: color .12s ease, text-decoration-color .12s ease, filter .12s ease;
            -webkit-tap-highlight-color: transparent;
        }

        /* Cite links — slightly stronger weight and accessible focus */
        .cite-link {
            color: var(--link-color);
            font-weight: 700;
            border-bottom: 1px dashed rgba(6,182,212,0.12);
        }
        .cite-link:visited { opacity: 0.9; color: rgba(6,182,212,0.9); }
        .cite-link:hover,
        .cite-link:focus {
            color: var(--link-hover);
            text-decoration-color: rgba(255,255,255,0.22);
            filter: drop-shadow(0 6px 14px rgba(6,182,212,0.08));
        }
        .cite-link:focus-visible {
            outline: 3px solid rgba(6,182,212,0.14);
            outline-offset: 4px;
            border-radius: 6px;
        }

        /* Ensure links inside the hover card inherit the accent and remain readable */
        .hover-card a { color: var(--accent); text-decoration: underline; }

        /* Explicitly preserve button color (fixes accidental overrides) */
        .btn, .btn .fab { color: inherit; }
        .btn-primary { color: #0f172a; }
        .btn-secondary { color: var(--text-secondary); }

        /* Conservative safeguards for other CTA/utility anchors:
           - icon-only links, APK links, modal links, and anchors used as buttons
           - keeps visual CTAs visible even if new link rules are added later
        */
        a[role="button"],
        a[aria-label],
        .modal-content a,
        a[href$=".apk"],
        .icon-link,
        a > .fab,
        a > .fas {
            color: inherit;
        }

        /* Respect user preference for higher contrast */
        @media (prefers-contrast: more) {
            .content-column a:not(.btn), .feature-text a:not(.btn) { text-decoration: underline; }
            .cite-link:focus-visible { outline-color: var(--accent); }
        }

        @media (max-width: 968px) {
            .hover-card { display: none !important; } /* disable on small/touch devices */
        }

        /* --- Developer section: smart responsive pyramid (grid at ≥1024px) --- */
        /* Full-bleed utility so the section spans the entire viewport like the footer */
        .full-bleed {
            width: 100vw;
            margin-left: calc(50% - 50vw);
            background: transparent; /* keep same background as page unless overridden */
            border-top: 1px solid rgba(255,255,255,0.04);
            padding: 72px 0;
        }
        .dev-inner { max-width: 1400px; margin: 0 auto; padding: 0 6%; }

        /* Builder's Note — centered, constrained to the dev column */
        .builder-note {
            max-width: 880px;
            margin: 18px auto 28px;
            text-align: center;
            font-style: italic;
            color: #fff;
            background: rgba(255,255,255,0.02);
            padding: 18px 22px;
            border-radius: 12px;
            border-left: 3px solid rgba(99,102,241,0.18);
            box-shadow: 0 6px 18px rgba(2,6,23,0.35);
        }
        .builder-note h4 { color: var(--text-secondary); margin: 0 0 8px; font-size: 0.95rem; }
        .builder-note p { margin: 0; font-size: 0.98rem; color: #e6eef6; }

        /* --- SMART RESPONSIVE PYRAMID (mobile-first) --- */
        .dev-grid-smart {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 24px;
            margin-top: 40px;
        }

        .dev-card {
            /* Base Mobile Style: Flexible width */
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.4) 0%, rgba(15, 23, 42, 0.9) 100%);
            border: 1px solid rgba(6, 182, 212, 0.08);
            border-radius: 18px;
            padding: 28px 22px;
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 320px; /* Limits width on mobile so they don't get huge */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dev-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0,0,0,0.35), 0 0 18px rgba(6,182,212,0.06);
        }

        .dev-image-wrapper {
            width: 108px;
            height: 108px;
            border-radius: 50%;
            padding: 6px;
            background: linear-gradient(135deg, rgba(99,102,241,0.12), rgba(6,182,212,0.08));
            display: grid; place-items: center; margin-bottom: 16px;
            border: 3px solid transparent;
        }
        .dev-image { width: 96px; height: 96px; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255,255,255,0.06); background: linear-gradient(135deg,#111827,#0f172a); }
        .dev-accent-blob { position: absolute; top: -18px; right: -18px; width: 72px; height: 72px; border-radius: 50%; filter: blur(28px); opacity: 0.55; background: linear-gradient(135deg,#06b6d4,#8b5cf6); z-index: 0; }
        .dev-name { color: #fff; margin: 6px 0 4px; font-size: 1.05rem; font-weight: 700; z-index: 2; }
        .dev-role { color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 8px; z-index: 2; font-weight: 600; }

        /* --- THE PYRAMID TRIGGER (1024px+) --- */
        @media (min-width: 1024px) {
            .dev-grid-smart {
                display: grid;
                /* Create a 6-column grid. We use 6 because it's divisible by 2 and 3 */
                grid-template-columns: repeat(6, 1fr);
                gap: 30px;
                max-width: 1000px; /* Constrain width to keep cards tight */
                margin-left: auto;
                margin-right: auto;
            }

            .dev-card {
                max-width: none; /* Let grid control the width */
                width: 100%;     /* Fill the grid cell */
            }

            /* First 2 items (Top Row): Span 3 columns each (50% width) */
            .dev-grid-smart .dev-card:nth-child(1),
            .dev-grid-smart .dev-card:nth-child(2) {
                grid-column: span 3;
            }

            /* Next 3 items (Bottom Row): Span 2 columns each (33% width) */
            .dev-grid-smart .dev-card:nth-child(3),
            .dev-grid-smart .dev-card:nth-child(4),
            .dev-grid-smart .dev-card:nth-child(5) {
                grid-column: span 2;
            }
        }

        /* Mobile fallback: small screens keep stacked/flow layout */
        @media (max-width: 767px) {
            .dev-card { width: 100%; max-width: 520px; padding: 22px; }
            .dev-grid-smart { gap: 18px; }
        }
    </style>
</head>
<body>

<div class="bg-blobs">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
</div>

<div class="modal-overlay" id="iosModal">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('iosModal')">&times;</button>
        <h2>iOS Beta Access</h2>
        <p>Scan via Expo Go to test on iPhone.</p>
        <div class="qr-placeholder"><img src="./img/qr-code.jpg" alt="Expo QR Code" class="qr-img"></div>
        <a href="https://apps.apple.com/us/app/expo-go/id982107779" style="color:var(--accent)">1. Get Expo Go App &rarr;</a>
    </div>
</div>
<div class="modal-overlay" id="termsModal">
    <div class="modal-content legal">
        <button class="close-modal" onclick="closeModal('termsModal')">&times;</button>
        <div id="terms-content"></div>
    </div>
</div>
<div class="modal-overlay" id="privacyModal">
    <div class="modal-content legal">
        <button class="close-modal" onclick="closeModal('privacyModal')">&times;</button>
        <div id="privacy-content"></div>
    </div>
</div>
<div class="modal-overlay" id="faqModal">
    <div class="modal-content legal">
        <button class="close-modal" onclick="closeModal('faqModal')">&times;</button>
        <h2>Frequently Asked Questions</h2>
        <div class="faq-section">
            <p style="font-style: italic; color: var(--accent); margin-bottom: 20px;">
                <strong>Note for Users Ages 13-16:</strong> FitFusion360 is designed for teens and adults, but we strongly recommend involving a parent or guardian in your fitness journey. Always consult with a healthcare professional or trusted adult before making significant changes to your diet or exercise routine. AI advice is for guidance only and not a substitute for professional medical or nutritional advice.
            </p>
            
            <h3>How do I create a personalized workout plan?</h3>
            <p>Complete the fitness survey during signup to receive a customized 4-week workout program based on your goals, fitness level, and available equipment. Teens: Start with beginner-friendly plans and discuss your choices with a parent or coach.</p>
            
            <h3>How accurate is the food image recognition?</h3>
            <p>Our AI-powered food recognition uses FatSecret and Clarifai to identify foods from images, with CalorieNinja providing nutritional data. While generally accurate, we recommend verifying nutritional information for best results. Teens: Have a parent or guardian help double-check food logs for accuracy.</p>
            
            <h3>What AI technologies does this app use?</h3>
            <p>We use Google Gemini AI for meal plan generation and our nutrition chatbot. GitHub Models serves as a fallback AI service. Clarifai and FatSecret power our food image recognition. All AI recommendations are guidance only and not medical advice. Teens: AI is a helpful tool, but always discuss suggestions with a trusted adult.</p>
            
            <h3>How does the AI handle my custom allergies?</h3>
            <p>If you add a custom allergy that the AI doesn't recognize, it will err on the side of caution and may avoid potentially related foods. Always verify meal plans if you have serious allergies. Teens: Tell a parent about any allergies before using the app, and have them review AI-generated plans.</p>
            
            <h3>Is my data shared with AI services?</h3>
            <p>Yes, when using AI features, relevant data (like your health profile, dietary preferences, and chatbot messages) is sent to third-party AI services (Google Gemini, GitHub Models) to generate personalized responses. See our Privacy Policy for details. Teens: We follow strict privacy rules (COPPA compliant), but discuss data sharing with your parents.</p>
            
            <h3>Can I change my workout reminder time?</h3>
            <p>Yes! Go to Profile > Notification Settings to customize your workout reminder time and notification preferences. Teens: Set reminders that fit your school schedule with parental approval.</p>
            
            <h3>How do I track my progress?</h3>
            <p>Use the Progress tab to view your workout history, nutrition logs, weight trends, and achievement statistics over time. Teens: Share your progress with parents or coaches for encouragement and safety checks.</p>
            
            <h3>What if I can't complete a workout?</h3>
            <p>You can modify exercises, skip exercises, or choose a different difficulty level. Listen to your body and adjust as needed. Teens: If something feels too hard or painful, stop immediately and tell a parent or adult.</p>
            
            <h3>Should I follow AI meal plans without consulting a doctor?</h3>
            <p>No. AI-generated meal plans and nutrition advice are for informational purposes only. Always consult with a healthcare professional, especially if you have medical conditions, take medications, or have specific dietary needs. Teens: Get approval from parents and a doctor before following any meal plans.</p>
            
            <h3>How do I delete my account?</h3>
            <p>Currently, you can sign out through Profile settings. To permanently delete your account and data, please contact our support team. Teens: Ask a parent to help with account management.</p>
            
            <h3>Is this app safe for teens?</h3>
            <p>FitFusion360 requires users to be at least 13 years old (COPPA compliant). The app includes safety features like minimum calorie floors and parental involvement recommendations. However, it's not a substitute for professional guidance. Teens: Use the app as a fun tool to learn about fitness, but always involve adults in your decisions.</p>
            
            <h3>How can parents help with my fitness journey?</h3>
            <p>Parents can review workout plans, meal suggestions, and progress tracking. We recommend discussing goals and changes with a trusted adult. Teens: Share your app usage with parents for better support and safety.</p>
        </div>
    </div>
</div>
<div class="modal-overlay" id="featuresModal">
    <div class="modal-content legal">
        <button class="close-modal" onclick="closeModal('featuresModal')">&times;</button>
        <h2>FitFusion360 Features</h2>
        <div class="faq-section">
            <h3>Adaptive Workout Programs</h3>
            <p>28-day personalized workout journeys with split-based training (Full Body, Upper/Lower, PPL, Push/Pull/Legs) tailored to your goals, fitness level, and equipment access. Coach-vetted for safety and progressive overload.</p>
            
            <h3>Clinical Nutrition Calculator</h3>
            <p>Mifflin-St Jeor BMR algorithm with activity multipliers from Institute of Medicine PAL values. Goal-based protein targets (1.4-2.5 g/kg) following ISSN guidelines.</p>
            
            <h3>AI-Powered Features</h3>
            <p>Google Gemini AI for meal plan generation and context-aware chatbot. Gemini Vision for food image recognition with fallback nutrition data.</p>
            
            <h3>Real-Time Progress Tracking</h3>
            <p>Firebase-powered real-time sync of workout history, nutrition logs, weight trends, and achievements. Works offline with cloud backup.</p>
            
            <h3>Smart Notifications</h3>
            <p>Local workout reminders based on your preferred schedule. Android HIGH importance channel for reliable delivery.</p>
            
            <h3>Safety Mechanisms</h3>
            <p>Minimum calorie floors (BMR × 1.2), protein caps (140-220g), and excess intake warnings based on scientific research. Guest mode for testing without accounts.</p>
            
            <h3>Daily Workout Restrictions</h3>
            <p>One workout per day limit with progress tracking across weeks. Unlocks sequentially to prevent overtraining and ensure recovery.</p>
            
            <h3>Goal-Based Customization</h3>
            <p>Support for Weight Loss, Muscle Gain, Strength, Endurance, and Flexibility goals with appropriate macro distributions and intensity modifiers.</p>
            
            <h3>Privacy-First Design</h3>
            <p>Local-first architecture with optional cloud sync. COPPA compliant for users 13+. OTP email security for account changes.</p>
            
            <h3>Scientific Backing</h3>
            <p>12+ peer-reviewed citations including Hall (2008) energy deficit research, Slater et al. (2019) surplus guidelines, and Jäger et al. (2017) protein recommendations.</p>
            
            <h3>Teen-Safe Features</h3>
            <p>Parental involvement recommendations, conservative defaults, and healthcare professional consultation reminders for users 13-16.</p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="howItWorksModal">
    <div class="modal-content legal">
        <button class="close-modal" onclick="closeModal('howItWorksModal')">&times;</button>
        <h2>How FitFusion360 Works</h2>
        <div class="faq-section">
            <h3>1. Sign Up & Age Verification</h3>
            <p>Create an account with email verification. The app requires users to be at least 13 years old (COPPA compliant). Teens: Get parental approval before starting.</p>
            
            <h3>2. Complete the Fitness Survey</h3>
            <p>Answer questions about your goals (Weight Loss, Muscle Gain, Strength, etc.), fitness level (Beginner/Intermediate/Advanced), available equipment, and preferences. This generates your personalized plan.</p>
            
            <h3>3. Receive Your Customized Plan</h3>
            <p>Get a 28-day workout program with split-based training (Full Body, Upper/Lower, PPL, etc.) and daily nutrition targets based on Mifflin-St Jeor BMR calculations and ISSN protein guidelines.</p>
            
            <h3>4. Track Your Meals Daily</h3>
            <p>Use AI food vision to snap photos of meals (Gemini Vision API) or log manually. The app calculates macros in real-time with safety floors and caps to prevent over/under-eating.</p>
            
            <h3>5. Complete One Workout Per Day</h3>
            <p>Follow your sequential workout plan. Daily restrictions ensure recovery - finish today's workout to unlock tomorrow's. Coach-vetted exercises with progressive overload.</p>
            
            <h3>6. Get AI Guidance & Progress Tracking</h3>
            <p>Use the context-aware chatbot for meal ideas, optimization tips, and support. View progress charts, weight trends, and achievements synced via Firebase (offline mode available).</p>
            
            <h3>7. Monitor & Adjust</h3>
            <p>Receive smart notifications for workout reminders. Review weekly progress and modify plans as needed. All data is privacy-first with optional cloud sync.</p>
            
            <h3>8. Achieve Your Goals Safely</h3>
            <p>Built with scientific backing (12+ citations). Safety features include minimum calorie floors, excess intake warnings, and parental oversight for teens.</p>
        </div>
    </div>
</div>

<div class="container">
    
    <div class="parallax-wrapper">
        <div class="floating-element layer-back" data-speed="0.1" style="top: 10%; left: 5%; font-size: 3rem;">⚡️</div>
        <div class="floating-element layer-back" data-speed="0.15" style="top: 30%; left: 85%; font-size: 4rem;">🧬</div>
        <div class="floating-element layer-mid" data-speed="0.3" style="top: 20%; left: 70%; font-size: 4rem;">💪</div>
        <div class="floating-element layer-mid" data-speed="0.35" style="top: 50%; left: 10%; font-size: 3.5rem;">🥗</div>
        <div class="floating-element layer-front" data-speed="0.6" style="top: 15%; left: 85%; font-size: 5rem;">🏃</div>
    </div>

    <div class="content-column">
        
        <section id="hero">
            <div class="logo-container">
                <img src="./img/fit-fusion-logo.png" alt="FitFusion Logo" class="logo-img">
                <span class="app-name" style="font-size: clamp(3rem, 5vw, 4.5rem); background: linear-gradient(135deg, #fff 0%, #cbd5e1 50%, #06b6d4 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; font-family: 'Oswald', sans-serif;">FitFusion360</span>
            </div>
            <h1>Fitness, <br>Evolved.</h1>
            <div class="value-matrix">
                <div class="vm-item"><span class="vm-label">INPUT</span><span>Your Goals & Data</span></div>
                <div style="align-self:center; opacity:0.5;">&rarr;</div>
                <div class="vm-item"><span class="vm-label">MECHANISM</span><span>Adaptive AI Logic</span></div>
                <div style="align-self:center; opacity:0.5;">&rarr;</div>
                <div class="vm-item"><span class="vm-label">OUTPUT</span><span>Measurable Results</span></div>
            </div>
            <p>The only self-help fitness app that combines clinical-grade nutrition algorithms with adaptive workout intelligence. Backed by 12+ peer-reviewed studies including Mifflin-St Jeor BMR formula and ISSN protein guidelines.</p>
            <div class="trust-bar">
                <div class="trust-item"><i class="fas fa-user-tie trust-icon"></i> Coach‑vetted workouts</div>
                <div class="trust-item"><i class="fas fa-check-circle trust-icon"></i> Dietitian‑Reviewed Algorithms</div>
                <div class="trust-item"><i class="fas fa-book trust-icon"></i> 12+ Scientific Citations</div>
            </div>
            <div class="btn-group">
                <a href="https://github.com/danmikel1/capstoneLandingPage/releases/download/v.1.2.2/FitFusion360.apk" class="btn btn-primary"><i class="fab fa-android"></i> Download APK (Beta)</a>
                <button class="btn btn-secondary" onclick="openModal('iosModal')"><i class="fab fa-apple"></i> iOS Preview</button>
            </div>
            <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                <i class="fas fa-user-secret"></i> or <a href="#" style="color:var(--text-secondary); text-decoration: underline;">Try Guest Mode</a> (No account needed)
            </div>
        </section>

        <section id="comparison">
            <h2>Why Switch to FitFusion360?</h2>
            <div class="glass-card">
                <table class="comparison-table">
                    <thead><tr><th>Feature</th><th>FitFusion360</th><th>Generic Apps</th></tr></thead>
                    <tbody>
                        <tr><td>Adaptive Plans</td><td><i class="fas fa-check check"></i> Dynamic 28-day programs</td><td><i class="fas fa-times cross"></i> Static PDF</td></tr>
                        <tr><td>Nutrition Logic</td><td><i class="fas fa-check check"></i> Clinical Mifflin-St Jeor BMR</td><td><i class="fas fa-times cross"></i> Generic Estimates</td></tr>
                        <tr><td>Data Privacy</td><td><i class="fas fa-check check"></i> Local-First with Offline Mode</td><td><i class="fas fa-times cross"></i> Cloud Sold</td></tr>
                        <tr><td>AI Features</td><td><i class="fas fa-check check"></i> Gemini Vision + Chatbot</td><td><i class="fas fa-times cross"></i> Basic Calculators</td></tr>
                        <tr><td>Progress Tracking</td><td><i class="fas fa-check check"></i> Real-time Firebase Sync</td><td><i class="fas fa-times cross"></i> Manual Logging</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="workouts">
            <div class="tag tag-blue">Adaptive Training</div>
            <h2>Pocket Personal Trainer</h2>
            <div style="font-size:0.95rem;color:var(--text-secondary);margin-top:6px;margin-bottom:12px;">Programs vetted by an experienced coach for safety and progressive overload.</div>
            <div class="glass-card">
                <ul class="feature-list">
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-dumbbell"></i></div><div class="feature-text"><strong>Customized Plans</strong><span>Tailored 28-day journey with split-based training (Full Body, Upper/Lower, PPL, Push/Pull/Legs) for Weight Loss, Muscle Gain, Strength, Endurance, or Flexibility goals.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-chart-line"></i></div><div class="feature-text"><strong>Journey Tracking</strong><span>Daily restrictions ensure accountability - complete ONE workout per day with progress monitoring across weeks. Unlocks sequentially for optimal progression.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-clock"></i></div><div class="feature-text"><strong>Smart Notifications</strong><span>Local workout reminders based on your preferred schedule. Android HIGH importance channel for reliable delivery.</span></div></li>
                </ul>
            </div>
        </section>

        <section id="nutrition">
            <div class="tag tag-purple">Clinical Nutrition</div>
            <h2>Science, Not Guesswork</h2>
            <div class="glass-card">
                <ul class="feature-list">
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-calculator"></i></div><div class="feature-text"><strong><a href="https://doi.org/10.1016/j.jada.2005.02.005" target="_blank" class="cite-link" data-title="Frankenfield et al. (2005) — RMR equations" data-text="Large-sample comparison showing the Mifflin–St Jeor equation most accurately predicts resting metabolic rate across BMI ranges; supports using Mifflin for clinical BMR estimates. Frankenfield, D., Roth‑Yousey, L., & Compher, C. (2005). <i>Journal of the American Dietetic Association, 105</i>(5), 775–789. https://doi.org/10.1016/j.jada.2005.02.005">Mifflin-St Jeor BMR Algorithm</a></strong><span>Evidence-based BMR calculation (most accurate for healthy adults per Frankenfield et al., 2005) combined with activity multipliers from Institute of Medicine PAL values.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-utensils"></i></div><div class="feature-text"><strong><a href="https://pubmed.ncbi.nlm.nih.gov/28642676/" target="_blank" class="cite-link" data-title="ISSN position stand (Jäger et al., 2017)" data-text="Consensus position recommending ~1.4–2.5 g/kg/day protein for active individuals with practical per‑meal and daily targets to support maintenance and hypertrophy. Jäger, R., Kerksick, C. M., Campbell, B. I., et al. (2017). <i>Journal of the International Society of Sports Nutrition, 14</i>, 20. https://doi.org/10.1186/s12970-017-0187-1">ISSN Protein Guidelines</a></strong><span>Goal-based protein targets (1.4-2.5 g/kg) following International Society of Sports Nutrition Position Stand (Jäger et al., 2017) for optimal muscle preservation and growth.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-camera"></i></div><div class="feature-text"><strong>AI Food Vision</strong><span>Snap a photo to auto-log meals via Gemini Vision API. Compact prompts under 20KB limit with fallback nutrition for common foods like chicken, rice, eggs.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-robot"></i></div><div class="feature-text"><strong>Context-Aware AI Chatbot</strong><span>Gemini-powered nutrition coach remembers your profile, goals, and conversation history. Provides personalized meal ideas and progress optimization without recommending competitors.</span></div></li>
                    <li class="feature-item"><div class="feature-icon"><i class="fas fa-shield-alt"></i></div><div class="feature-text"><strong>Safety Mechanisms</strong><span>Minimum calorie floor (BMR × 1.2), protein caps (140-220g), and excess intake warnings based on <a href="https://doi.org/10.1038/sj.ijo.0803720" target="_blank" class="cite-link" data-title="Hall (2008) — energy-balance model" data-text="Quantitative energy-balance model showing body-weight change follows energy imbalance with adaptive metabolic adjustments; useful for realistic deficit-to-weight-loss planning. Hall, K. D. (2008). <i>International Journal of Obesity, 32</i>(3), 573–576. https://doi.org/10.1038/sj.ijo.0803720">Hall (2008)</a> deficit requirements and <a href="https://doi.org/10.3389/fnut.2019.00131" target="_blank" class="cite-link" data-title="Slater et al. (2019) — surplus for muscle" data-text="Practical review quantifying calorie-surplus strategies (≈250–500 kcal/day) and expected lean-mass gains with athlete-focused implementation guidance. Slater, G. J., et al. (2019). <i>Frontiers in Nutrition, 6</i>, 131. https://doi.org/10.3389/fnut.2019.00131">Slater et al. (2019)</a> surplus guidelines.</span></div></li>
                </ul>
            </div>
        </section>

        <section id="tech">
            <div class="tag tag-blue">Smart Tech</div>
            <h2>Context-Aware Intelligence</h2>
            <p>A chatbot that remembers your goals, injuries, and preferences across every conversation. Built with Firebase real-time sync and offline-first architecture.</p>
            <div class="glass-card" style="border-left: 4px solid var(--success);">
                <h3 style="color:var(--success)">🛡️ Privacy & Security</h3>
                <ul class="feature-list">
                    <li class="feature-item" style="margin-bottom:5px;"><i class="fas fa-check-circle" style="color:var(--success); margin-top:4px;"></i><span style="color:#ccc; font-size:0.95rem;"><strong>Dietitian-Reviewed</strong> Algorithms with 12+ citations</span></li>
                    <li class="feature-item" style="margin-bottom:5px;"><i class="fas fa-check-circle" style="color:var(--success); margin-top:4px;"></i><span style="color:#ccc; font-size:0.95rem;"><strong>Offline Mode</strong> with Cloud Sync for uninterrupted tracking</span></li>
                    <li class="feature-item" style="margin-bottom:5px;"><i class="fas fa-check-circle" style="color:var(--success); margin-top:4px;"></i><span style="color:#ccc; font-size:0.95rem;"><strong>Guest Mode</strong> for testing without account creation</span></li>
                    <li class="feature-item"><i class="fas fa-check-circle" style="color:var(--success); margin-top:4px;"></i><span style="color:#ccc; font-size:0.95rem;"><strong>OTP Email Security</strong> for account changes with EmailJS integration</span></li>
                </ul>
            </div>
        </section>

        <!-- developers moved below -->

    </div>

    <div class="visual-column">
        <div class="phone-wrapper" id="phone">
            <div class="annotation anno-1"><div class="pulse"></div><span>Macro Floor</span></div>
            <div class="annotation anno-2"><div class="pulse"></div><span>Context Memory</span></div>
            <div class="annotation anno-3"><div class="pulse"></div><span>Auto-Lock</span></div>
            
            <div class="phone-frame">
                <div class="punch-hole"></div>
                <div class="hw-btn power"></div>
                <div class="hw-btn vol-rocker"></div>
                <div class="screen-container">
                    
                    <div class="app-view active" id="screen-dashboard">
                        <div class="app-header">
                            <div class="app-brand"><img src="./img/fit-fusion-logo.png" class="app-logo-small"><span class="app-name">Food Tracker</span></div>
                            <div class="guest-badge"><div class="guest-dot"></div>Guest Mode</div>
                        </div>
                        <div class="app-content">
                            <div class="date-nav">
                                <button class="nav-circle"><i class="fas fa-chevron-left"></i></button>
                                <div class="date-center"><div class="date-title">Thu, Jan 22</div><div class="date-sub">2026-01-22</div></div>
                                <button class="nav-circle"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="toggle-row">
                                <button class="toggle-btn toggle-outline"><i class="far fa-calendar"></i> Today</button>
                                <button class="toggle-btn toggle-filled"><i class="fas fa-calendar-alt"></i> Calendar</button>
                            </div>
                            <div class="progress-card">
                                <div class="card-title">Daily Progress</div>
                                <div class="ring-container">
                                    <svg class="ring-svg"><circle class="ring-bg" cx="160" cy="160" r="140"></circle><circle class="ring-fill" cx="160" cy="160" r="140"></circle></svg>
                                    <div class="ring-text"><span class="ring-num">0</span><span class="ring-sub">of 2171<br>calories</span></div>
                                </div>
                                <div class="macro-row">
                                    <div class="macro-item"><div class="macro-bar mb-green"><div></div></div><span class="macro-val">0g</span><span class="macro-lbl">Protein</span><div class="macro-goal">Goal: 154g (ISSN)</div></div>
                                    <div class="macro-item"><div class="macro-bar mb-yellow"><div></div></div><span class="macro-val">0g</span><span class="macro-lbl">Carbs</span><div class="macro-goal">Goal: 253g</div></div>
                                    <div class="macro-item"><div class="macro-bar mb-purple"><div></div></div><span class="macro-val">0g</span><span class="macro-lbl">Fat</span><div class="macro-goal">Goal: 60g</div></div>
                                </div>
                                <div class="card-footer">
                                    <span class="footer-badge fb-blue"><i class="fas fa-flag"></i> Lose Weight</span>
                                    <span class="footer-badge fb-purple"><i class="fas fa-chart-line"></i> Beginner Level</span>
                                </div>
                            </div>
                            <div class="log-header">
                                <div class="log-title">Log Your Meals</div>
                                <div class="log-sub">Track what you eat to reach your goals</div>
                            </div>
                        </div>
                        <div class="bottom-nav">
                            <div class="nav-item"><i class="fas fa-home"></i><span>Home</span></div>
                            <div class="nav-item"><i class="fas fa-dumbbell"></i><span>Workouts</span></div>
                            <div class="nav-item active"><i class="fas fa-utensils"></i><span>Diet</span></div>
                            <div class="nav-item"><i class="fas fa-chart-line"></i><span>Progress</span></div>
                            <div class="nav-item"><i class="fas fa-user"></i><span>Profile</span></div>
                        </div>
                    </div>

                    <div class="app-view" id="screen-workout">
                        <div class="workout-header">
                            <div class="back-btn"><i class="fas fa-arrow-left"></i></div>
                            <div style="flex:1; text-align:center;">
                                <div class="workout-nav-title">Day 2</div>
                                <div class="workout-sub">0/7 exercises (0.0%)</div>
                            </div>
                            <div style="width:40px"></div>
                        </div>
                        <div class="app-content">
                            <div class="workout-card">
                                <span class="badge-pill">1 of 7</span>
                                <h2 class="ex-title">Close-Grip Dumbbell Press</h2>
                                <div class="video-placeholder">
                                    <div class="vid-overlay"><i class="fas fa-redo"></i> Follow the movement pattern</div>
                                </div>
                                <div class="tag-row">
                                    <div class="tag-chip"><i class="fas fa-sync" style="color:#7C3AED;"></i> 2 sets</div>
                                    <div class="tag-chip"><i class="fas fa-dumbbell" style="color:#10B981;"></i> 12-15 reps</div>
                                    <div class="tag-chip"><i class="fas fa-stopwatch" style="color:#F59E0B;"></i> 30-60s rest</div>
                                </div>
                            </div>
                            <div class="set-card">
                                <div style="font-weight:700; color:#111; margin-bottom:10px;">Set 1 of 2 • 12-15 reps</div>
                                <div class="timer-circle">
                                    <div class="timer-val">0:42</div>
                                    <div class="timer-lbl">Exercise</div>
                                </div>
                            </div>
                        </div>
                        <div class="workout-actions">
                            <div class="btn-ex btn-ex-light"><i class="fas fa-eye"></i> Instructions</div>
                            <div class="btn-ex btn-ex-dark">Finish Exercise <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </div>

                    <div class="app-view" id="screen-chat">
                        <div class="chat-header">
                            <div class="back-btn"><i class="fas fa-arrow-left"></i></div>
                            <div class="chat-title">FitFusion360 Chatbot</div>
                        </div>
                        <div class="chat-body">
                            <div class="bot-msg">
                                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                                <div class="msg-bubble">
                                    <div class="msg-text">👋 Hi! I'm your FitFusion360 AI coach. I'm here to help you reach your fitness goals through smart nutrition and personalized guidance.</div>
                                    <div class="msg-text" style="font-weight:700;">What I can help with:</div>
                                    <ul class="msg-list">
                                        <li>🍽️ Custom meal ideas for your goals</li>
                                        <li>📊 Nutrition tracking & analysis</li>
                                        <li>💪 Pre/post-workout fuel strategies</li>
                                        <li>🎯 Progress optimization tips</li>
                                        <li>🥗 Recipes & meal prep ideas</li>
                                    </ul>
                                    <div class="msg-text">I already know your profile, so just ask me anything!</div>
                                    <div class="msg-disclaimer">
                                        <i class="fas fa-exclamation-triangle" style="color:#F59E0B;"></i>
                                        <span><strong>Note:</strong> AI-generated advice is for informational purposes only and may contain errors. Always consult a professional.</span>
                                    </div>
                                    <div style="font-size:0.7rem; color:#9CA3AF; margin-top:5px; text-align:right;">10:16 PM</div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-footer">
                            <div class="suggestion-row">
                                <div class="suggestion-chip"><i class="fas fa-utensils"></i> Meal ideas</div>
                                <div class="suggestion-chip"><i class="far fa-lightbulb"></i> Daily tip</div>
                                <div class="suggestion-chip"><i class="fas fa-dumbbell"></i> Pre-workout</div>
                            </div>
                            <div class="input-box">
                                <span>Ask me anything about nutrition...</span>
                                <div class="send-btn"><i class="fas fa-paper-plane"></i></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>

<section id="developers" class="full-bleed">
    <div class="dev-inner">
        <div class="tag tag-purple">The Builders</div>
        <div style="text-align: center; max-width: 800px; margin: 0 auto 40px;">
            <h2>The Team</h2>
            <p>Two developers and a three-person documentation team responsible for clinical, API, and user-facing docs.</p>
        </div>

        <div class="builder-note">
            <h4>Builder's Note</h4>
            <p>"We built FitFusion360 because generic fitness apps wanted users to fail so they can sell subscriptions. This is the tool everyone needs: blunt, effective, and scientifically grounded with references like Mifflin‑St Jeor, ISSN protein guidelines, and Hall's energy deficit research."</p>
        </div>

        <div class="dev-grid-smart" aria-label="Team members">
            
            <div class="dev-card">
                <div class="dev-accent-blob"></div>
                <div class="dev-image-wrapper"><img src="./img/sean.jpeg" alt="Sean" class="dev-image"></div>
                <h3 class="dev-name">Sean</h3>
                <div class="dev-role">Developer</div>
            </div>

            <div class="dev-card">
                <div class="dev-accent-blob" style="background: var(--accent-purple);"></div>
                <div class="dev-image-wrapper"><img src="./img/dan.jpg" alt="Dan" class="dev-image" style="border-color: var(--accent-purple);"></div>
                <h3 class="dev-name">Dan</h3>
                <div class="dev-role">Developer</div>
            </div>

            <div class="dev-card">
                <div class="dev-accent-blob"></div>
                <div class="dev-image-wrapper"><img src="./img/ash.jpg" alt="Alyssa" class="dev-image"></div>
                <h3 class="dev-name">Alyssa</h3>
                <div class="dev-role">Technical Writer</div>
            </div>

            <div class="dev-card">
                <div class="dev-accent-blob" style="background: var(--accent-purple);"></div>
                <div class="dev-image-wrapper"><img src="./img/biboy.jpg" alt="Biboy" class="dev-image" style="border-color: var(--accent-purple);"></div>
                <h3 class="dev-name">Biboy</h3>
                <div class="dev-role">Technical Writer</div>
            </div>

            <div class="dev-card">
                <div class="dev-accent-blob"></div>
                <div class="dev-image-wrapper"><img src="./img/roque.jpg" alt="Roque" class="dev-image"></div>
                <h3 class="dev-name">Roque</h3>
                <div class="dev-role">Technical Writer</div>
            </div>

        </div>
    </div>
</section>

<footer>
    <div class="footer-content">
        <div class="footer-section powered-by">
            <h3>Powered by</h3>
            <div class="powered-item">
                <i class="fab fa-google powered-icon"></i>
                <div class="powered-text">
                    <strong>Google Gemini</strong>
                    <span>AI Assistant & Vision API</span>
                </div>
            </div>
            <div class="powered-item">
                <i class="fas fa-database powered-icon"></i>
                <div class="powered-text">
                    <strong>Firebase</strong>
                    <span>Real-time Backend & Sync</span>
                </div>
            </div>
            <div class="powered-item">
                <i class="fas fa-mobile-alt powered-icon"></i>
                <div class="powered-text">
                    <strong>Expo</strong>
                    <span>React Native Development Platform</span>
                </div>
            </div>
            <div class="powered-item">
                <i class="fas fa-shield-alt powered-icon"></i>
                <div class="powered-text">
                    <strong>EmailJS</strong>
                    <span>Secure OTP Email Service</span>
                </div>
            </div>
        </div>
        
        <div class="footer-links">
        <div class="footer-section">
            <h3>Quick Links</h3>
            <ul>
                <li><button onclick="openModal('featuresModal')">Features</button></li>
                <li><button onclick="openModal('howItWorksModal')">How It Works</button></li>
                <li><button onclick="openModal('faqModal')">FAQ</button></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h3>Legal</h3>
            <ul>
                <li><button onclick="openModal('privacyModal')">Privacy Policy</button></li>
                <li><button onclick="openModal('termsModal')">Terms of Service</button></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h3>Download</h3>
            <ul>
                <li><a href="https://github.com/danmikel1/capstoneLandingPage/releases/download/v.1.2.1/FitFusion360.apk"><i class="fab fa-android"></i> Download APK (Beta)</a></li>
                <li><button onclick="openModal('iosModal')"><i class="fab fa-apple"></i> Coming Soon (iOS)</button></li>
            </ul>
        </div>
        </div>
        
        <div class="copyright">
            &copy; 2026 FitFusion360. All rights reserved. Built with React Native & Expo.
        </div>
    </div>
</footer>

<script>
    // Initialize EmailJS
    (function() {
        emailjs.init('YOUR_PUBLIC_KEY'); // Replace with your EmailJS public key
    })();

    const phone = document.getElementById('phone');
    const sections = document.querySelectorAll('section');
    const elements = document.querySelectorAll('.floating-element');
    
    // Screens
    const screenDashboard = document.getElementById('screen-dashboard');
    const screenWorkout = document.getElementById('screen-workout');
    const screenChat = document.getElementById('screen-chat');

    function openModal(modalId) { 
        document.getElementById(modalId).classList.add('active'); 
        document.body.style.overflow = 'hidden';
        if (modalId === 'termsModal') {
            fetch('terms.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const content = doc.querySelector('.legal-content');
                    document.getElementById('terms-content').innerHTML = content ? content.innerHTML : html;
                });
        } else if (modalId === 'privacyModal') {
            fetch('privacy.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const content = doc.querySelector('.legal-content');
                    document.getElementById('privacy-content').innerHTML = content ? content.innerHTML : html;
                });
        }
    }
    function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); document.body.style.overflow = 'auto'; }
    window.onclick = function(event) { if (event.target.classList.contains('modal-overlay')) { event.target.classList.remove('active'); document.body.style.overflow = 'auto'; } }

    let mouseX = 0; let mouseY = 0;
    document.addEventListener('mousemove', (e) => { mouseX = (e.clientX / window.innerWidth) * 2 - 1; mouseY = (e.clientY / window.innerHeight) * 2 - 1; });

    function switchScreen(screenId) {
        document.querySelectorAll('.app-view').forEach(el => el.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    let ticking = false;
    window.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(() => {
                const scrollY = window.scrollY;
                
                // SCROLL SPY
                const workoutsTop = document.getElementById('workouts').offsetTop - 400;
                const techTop = document.getElementById('tech').offsetTop - 400;
                
                if (scrollY < workoutsTop) { switchScreen('screen-dashboard'); } 
                else if (scrollY >= workoutsTop && scrollY < techTop) { switchScreen('screen-workout'); } 
                else { switchScreen('screen-chat'); }

                // 3D ROTATION - Removed rotation, keep scale and screen switching
                if (window.innerWidth > 968) {
                    const scale = window.innerWidth > 1200 ? 0.5 : 0.4;
                    phone.style.transform = `scale(${scale})`;
                    elements.forEach((el) => {
                        const speed = parseFloat(el.getAttribute('data-speed'));
                        const yPos = scrollY * speed;
                        const rot = scrollY * 0.02;
                        el.style.transform = `translateY(${yPos}px) rotate(${rot}deg)`;
                    });
                }
                ticking = false;
            });
            ticking = true;
        }
    });


    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
    }, { threshold: 0.15 });
    sections.forEach(section => observer.observe(section));

    /* --- Citation hover-preview logic --- */
    document.addEventListener('DOMContentLoaded', function initCitationPreviews() {
        const previewBox = document.getElementById('citation-preview');
        const previewTitle = document.getElementById('preview-title');
        const previewText = document.getElementById('preview-text');
        let activeTimeout = null;

        if (!previewBox) return;

        // Utility: keep preview inside viewport
        function clampPosition(x, y) {
            const pad = 12;
            const rect = previewBox.getBoundingClientRect();
            const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
            const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
            let left = x + 15;
            let top = y + 15;
            if (left + rect.width + pad > vw) left = x - rect.width - 15;
            if (left < pad) left = pad;
            if (top + rect.height + pad > vh) top = y - rect.height - 15;
            if (top < pad) top = pad;
            return { left, top };
        }

        // Attach behavior to all cite-link anchors (progressive enhancement)
        document.querySelectorAll('.cite-link').forEach(link => {
            // show only for non-touch pointers
            link.addEventListener('pointerenter', (e) => {
                if (window.matchMedia('(pointer: coarse)').matches) return;
                // populate (render HTML — APA requires <i>)
                previewTitle.innerHTML = link.getAttribute('data-title') || '';
                previewText.innerHTML = link.getAttribute('data-text') || '';
                previewBox.setAttribute('aria-hidden', 'false');

                const pos = clampPosition(e.pageX, e.pageY);
                previewBox.style.left = pos.left + 'px';
                previewBox.style.top = pos.top + 'px';
                previewBox.style.transform = 'translateZ(60px) scale(1)';
            });

            link.addEventListener('pointermove', (e) => {
                if (previewBox.getAttribute('aria-hidden') === 'true') return;
                const pos = clampPosition(e.pageX, e.pageY);
                previewBox.style.left = pos.left + 'px';
                previewBox.style.top = pos.top + 'px';
            });

            ['pointerleave', 'blur'].forEach(evt => {
                link.addEventListener(evt, () => {
                    previewBox.setAttribute('aria-hidden', 'true');
                    previewBox.style.transform = 'translateZ(0) scale(0.98)';
                });
            });

            // make previews keyboard-accessible
            link.addEventListener('focus', (e) => {
                previewTitle.innerHTML = link.getAttribute('data-title') || '';
                previewText.innerHTML = link.getAttribute('data-text') || '';
                previewBox.setAttribute('aria-hidden', 'false');
                const rect = link.getBoundingClientRect();
                const pos = clampPosition(rect.right, rect.top);
                previewBox.style.left = pos.left + 'px';
                previewBox.style.top = pos.top + 'px';
            });
        });

        // hide on Escape
        document.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape') {
                previewBox.setAttribute('aria-hidden', 'true');
            }
        });

        // hide when window resized
        window.addEventListener('resize', () => previewBox.setAttribute('aria-hidden', 'true'));
    });

</script>

<!-- Citation preview container (rendered by JS) -->
<div id="citation-preview" class="hover-card" aria-hidden="true" role="dialog" aria-label="Citation preview" tabindex="-1">
  <h4 id="preview-title"></h4>
  <p id="preview-text"></p>
</div>
</body>
</html>